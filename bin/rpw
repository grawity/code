#!/usr/bin/env bash
# rpw - generate a random password

_rpw() {
	tr -dc "A-Za-z0-9" < /dev/urandom | case $1 in
		"") head -c 20 | sed -r "s/.{5}/-&/g; s/^-//";;
		-*) head -c $((-$1)) | sed -r "s/.{5}/-&/g; s/^-//";;
		*) head -c "$1";;
	esac
}

length=-20
lcase=0

for arg; do
	case $arg in
	-l)		lcase=1;;
	-[0-9]*)	length=$arg;;
	[0-9]*)		length=$arg;;
	*)		echo "rpw: bad arg '$arg'" >&2; exit 2;;
	esac
done

pw=$(_rpw "$length")

if (( lcase )); then
	pw=${pw,,}
fi

printf '%s\n' "$pw"
