#!/usr/bin/env bash

hist=${XDG_CACHE_HOME:-$HOME/.cache}/dmenu.history

prompt='run:'

font='Monospace 12'
font='Sans 12'

# dmenu/wmii
normal_fg='#bbbbbb'
normal_bg='#222222'
selected_fg='#eeeeee'
selected_bg='#005577'

# bemenu
#normal_fg='#cacaca'
normal_bg='#121212'
title_fg='#d81860'
title_bg='#121212'

menu=(dmenu -l 7 -fn "$font"
	-nb "$normal_bg"
	-nf "$normal_fg"
	-sb "$selected_bg"
	-sf "$selected_fg")

#menu=(rofi -dmenu -location 0
#	#-color-window "$normal_bg,$title_fg"
#	#-color-normal "$normal_bg,$normal_fg,$normal_bg,$selected_bg,$selected_fg"
#	)

#menu=(bemenu -l 7 --fn "$font"
#	--nb "$normal_bg"
#	--nf "$normal_fg"
#	--hb "$selected_bg"
#	--hf "$selected_fg"
#	--tb "$title_bg"
#	--tf "$title_fg")

ign='mm'

_ign="^($ign)( |\$)"

input=$(dmenu-print-history "$hist" | "${menu[@]}" -p "$prompt")

if [[ "$input" ]]; then
	if ! [[ "$input" =~ $_ign ]]; then
		echo "$(date +%s) $input" >> "$hist"
	fi

	echo "$input" | ${SHELL:-/bin/sh} &
fi
