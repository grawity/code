#!/usr/bin/env bash
# gdevel - set up environment for local GNOME builds

joinvar() { local IFS="$2"; export "$1"="${*:3}"; }

export gnome="$HOME/lib/GNOME"
export TAG="gnome"

mkdir -p "$gnome/share/aclocal"

export ACLOCAL_FLAGS="-I $gnome/share/aclocal"
export ACLOCAL="aclocal $ACLOCAL_FLAGS"

mkdir -p "$gnome/include" "$gnome/lib"

export CFLAGS="-g -I$gnome/include"
#export LDFLAGS="-L$gnome/lib"

joinvar LD_LIBRARY_PATH ":"			\
	"$gnome/lib"				\
	"$LD_LIBRARY_PATH"			\
	;
joinvar LD_RUN_PATH ":"				\
	"$gnome/lib"				\
	"$LD_RUN_PATH"				\
	;
joinvar PATH ":"				\
	"$gnome/sbin"				\
	"$gnome/bin"				\
	"/usr/lib/ccache/bin"			\
	"$PATH"					\
	;
joinvar PKG_CONFIG_PATH ":"			\
	"$gnome/lib/pkgconfig"			\
	"$gnome/share/pkgconfig"		\
	;
joinvar XDG_DATA_DIRS ":"			\
	"$gnome/share"				\
	"$XDG_DATA_DIRS"			\
	;
#joinvar PYTHONPATH ":" \
#	"$gnome/lib/python2.7"			\
#	"$gnome/lib/python2.7/site-packages"	\
#	"$gnome/lib/python3.2"			\
#	"$gnome/lib/python3.2/site-packages"	\
#	;

# Not needed if gobject-introspection is built
#export INTROSPECTION_TYPELIBDIR="$gnome/lib/girepository-1.0"
#export INTROSPECTION_GIRDIT="$gnome/share/gir-1.0"

export GNULIB_SRCDIR="$HOME/src/gnu/gnulib"

export GDK_BACKEND="x11"

cgmigrate gdevel $$ >/dev/null

(( $# )) || set -- "$SHELL"; exec "$@"
