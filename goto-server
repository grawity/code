#!/usr/bin/env bash
# go - quick connection script

. lib.bash || exit

do_sshfs() {
	local src=$1 mtpt=$2
	mkdir -p "$mtpt"
	mountpoint -q "$mtpt" ||
		sshfs -o idmap=none "$src" "$mtpt"
	echo "Mounted sshfs#$src on $mtpt"
}

do_rdp() {
	local host=$1
	debug "using RDP to $host"
	mstsc "$host" "${@:2}"
	debug "spawned 'mstsc...'"
}

do_ssh() {
	debug "using SSH to $1"
	exec ssh "$@"
}

cd ~

case ${0##*/} in
    go|goto-server)
	;;
    *)
	set -- "${0##*/}" "$@"
	;;
esac

case $1 in
    snow)
	host="snow"
	if [[ $2 == "fs" ]]; then
		do_sshfs "$host:/" "$XDG_RUNTIME_DIR/fs/snow"
	elif [[ $2 == "suspend" || $2 == "hibernate" ]]; then
		do_ssh "$host" -oControlPersist=no \
			-oServerAliveInterval=1 \
			-oServerAliveCountMax=5 \
			"$2" &
	elif [[ $2 == "rdp" || (! $2 && ! -t 0) ]]; then
		do_rdp "$host"
	else
		do_ssh "$host" "${@:2}"
	fi
	;;
    ukdga|dga)
	host="193.219.181.252"
	do_rdp "$host:1969" "${@:2}"
	;;
    ukweb)
	host="193.219.181.209"
	if [[ $2 == -a ]]; then
		user='UTENOS-KOLEGIJA\Administrator'
	else
		user='UTENOS-KOLEGIJA\Mantas'
	fi; export user
	do_rdp "$host:1969"
	;;
    ukmoodle)
	host="193.219.181.221"
	if [[ $2 == -a ]]; then
		user='UTENOS-KOLEGIJA\Administrator1'
	else
		user='USer'
	fi; export user
	do_rdp "$host"
	;;
    krantas)
	host="193.219.181.210"
	do_rdp "$host" -F
	;;
    ukftp)
	host="193.219.181.197"
	if [[ $2 == -a ]]; then
		user='Administrator'
	else
		user='User'
	fi; export user
	do_rdp "$host"
	;;
    ukfc)
	host="193.219.181.220"
	user=FC; export user
	do_rdp "$host"
	;;
    ukstekas)
	host="192.168.20.8"
	user=Stekas; export user
	do_rdp "$host"
	;;
    gmail)
	host="imaps://imap.gmail.com"
	exec mutt -f "$host"
	;;
    '')
	echo "Usage: $progname <host>" >&2
	die "missing host name"
	;;
    *)
	die "unknown host '$1'";
esac
# vim: sts=8
