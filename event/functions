#!bash
name=${0##*/}
name=${name%%-*}

log() { echo "event/$*"; }

die() {
	echo "$*" >&2
	exit 1
}

notify() {
	echo "$name: $1"
	echo "    ${@:2}"
	state[notify_id]=$(command notify \
				-r "${state[notify_id]:-0}" \
				-a "${appname:=$name}" \
				-i "${icon:-info}"
				"$@")
}

join() { local IFS=$2; declare -g "$1=${*:3}"; }

save_state() {
	{ echo '#!bash'; declare -p state; } >"$state_file"
	exit
}

declare -A state
declare -- state_file=~/bin/event/.state.$name
declare -- icon=''
[[ -f "$state_file" ]] && . "$state_file"
trap 'save_state' EXIT

[[ $1 ]] && event=$1
