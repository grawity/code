#!/usr/bin/env bash
# go - quick connection script

. lib.bash || exit

progname='goto-server'

alias_file="$path_config/servers.txt"

usage() {
	echo "Usage: $progname <host>"
}

cd ~

if [[ $0 != */@(go|goto-server|@) ]]; then
	set -- "${0##*/}" "$@"
fi

if [[ ! $1 ]]; then
	usage >&2
	die "missing host name"
fi

name="$1"
rest=

if [[ $2 && $2 != /* ]]; then
	name+="-$2"; shift
fi

if [[ -f "$alias_file" ]]; then
	debug "looking for name '$name'"
	while read -r _name _ip _rest; do
		if [[ $name == "$_name" ]]; then
			name=$_ip
			rest=$_rest
			break
		fi
	done < "$alias_file"
	debug "resulting name='$name' rest='$rest'"
fi

case $name in
    imap://*|imaps://*)
	mutt -f "$name$2" $rest;;
    rdp://*)
	mstsc "${name#rdp://}" $rest;;
    *://*)
	die "unknown protocol '${name%%//*}//'";;
    "")
	mstsc "$name" $rest;;
    *)
	mstsc "$name" $rest;;
esac
