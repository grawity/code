#!/usr/bin/env bash
# wrapper for 'qemu-system-*' choosing the apropriate architecture and KVM flag

: ${arch:=`uname -m`}
: ${nic:="pcnet"}

case $arch in
    i?86|x86_64)
	kvm='-enable-kvm';;
    *)
	kvm='';;
esac

#vnet='-net vde'
vnet='-net bridge,br=vmbr'

xargs=()

for arg; do
	case $arg in
	    -no-kvm)
		kvm='';;
	    -no-vnet)
	        vnet='';;
	    *)
		xargs+=("$arg");;
	esac
done

args=(
	qemu-system-$arch
	$kvm
	-monitor "stdio"
	-ctrl-grab
	-net "nic,model=$nic"
	$vnet
	"${xargs[@]}"
)

exec "${args[@]}"
