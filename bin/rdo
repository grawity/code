#!/usr/bin/env bash
# rdo -- run command across all hosts

hosts=$(rlisthosts)

if (( ! $# )); then
	echo "error: Command not specified" >&2
	exit 1
elif (( $# == 1 )); then
	cmd="$1"
else
	cmd="${*@Q}"
fi

cmd="(${cmd:-:}) 2>&1 || echo '=> '\$?"

(for host in $hosts; do
	echo "$host:$(ssh -n $host "$cmd" | sed 's/^/\t/')" &
done
wait)
