#!/bin/sh
# Environment wrapper

export PULSE_PROP="application.icon_name='runescape'"
export PULSE_PROP_OVERRIDE="application.name='RuneScape'"

case $1 in
    "--beta")
	shift; set -- "--prmfile=beta.prm" "$@";;
    "--classic")
    	zenity --error --text="RuneScape Classic won't work with this.";
	exit 1;;
    "--custom")
    	shift; set -- "--prmfile=custom.prm" "$@";;
    "--oldschool")
	shift; set -- "--prmfile=oldschool.prm" "$@";;
    "@"*)
	f=${1#'@'}; f=${f%'.prm'}
	shift; set -- "--prmfile=$f.prm" "$@";;
esac

~/.local/rsu-client/runescape/runescape --unixquery "$@" & pid=$!

xprop -spy -root | while read _ && test -e /proc/$pid; do
	ids=$(wmctrl -lx | awk '$3 ~ /\.jagexappletviewer$/ {print $1}')
	for id in $ids; do
		xprop -f _GTK_THEME_VARIANT 8u -set _GTK_THEME_VARIANT dark -id $id
	done
done
