#!/usr/bin/env perl
use Net::DBus;

my $bus = Net::DBus->session;

sub Systemd {
	$bus
	->get_service("org.freedesktop.systemd1")
	->get_object(shift // "/org/freedesktop/systemd1")
}

sub GnomeSessionManager {
	$bus
	->get_service("org.gnome.SessionManager")
	->get_object(shift // "/org/gnome/SessionManager")
}

sub DBus {
	$bus
	->get_bus_object
}

my @env = @ARGV;
my %env = map {split /=/, $_, 2} @env;

Systemd->SetEnvironment(\@env);

DBus->UpdateActivationEnvironment(\%env);

if ($bus->get_service_owner("org.gnome.SessionManager")) {
	eval {GnomeSessionManager->Setenv($_, $env{$_}) for keys %env};
}
