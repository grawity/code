#!/usr/bin/env bash

. lib.bash || exit

if [[ ${0##*/} == @?* ]]; then
	host=${0##*/}
	host=${host#@}
elif [[ ${0##*/} == @ && $1 ]]; then
	host=$1
	shift
else
	die "missing hostname"
fi

if (( $# == 0 )); then
	qcmd="bash"
elif (( $# == 1 )) && [[ $1 == *\ * ]]; then
	qcmd="$1"
else
	qcmd="${@@Q}"
fi

(( $# )) || set bash

ssh -q -t "$host" ". ~/.profile && cd ${PWD@Q} && ($qcmd)"
