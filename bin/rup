#!/usr/bin/env bash

hosts='
	wolke
	sky
	star
	land
	ember
	wind
'

(for host in $hosts; do
	ssh $host 'printf "%s\t%s\t%s\t[%s]\t%s used (%s free)\t%s\t%s\n" \
			"$(hostname)" \
			"$(uname -r)" \
			"$(uptime -p | sed "s/,.*//")" \
			"$(uname -v)" \
			"$(free -b | awk "/^Mem:/{printf \"%2.0f%%\", \$3*100/\$2}")" \
			"$(free -b | awk "/^Mem:/{print \$7}" | numfmt --to=iec)" \
			"$(free -b | awk "/^Mem:/{print \$2}" | numfmt --to=iec)" \
			"$(uptime | sed "s/.*load average: //")" \
			' &
done
wait) |
sort -V -k 2,1 |
column -t -s $'\t' -N "HOST,KERNEL,UPTIME,BUILD,MEM USAGE,MEM TOTAL,LOAD AVG" -H "BUILD"
