#!/bin/bash

. lib.bash || exit

usage() {
	echo "Usage: $progname [-u <url>] <title> <summary> [<body>]"
	echo
	echo_opt "-u <url>" "Set a URL for the notification"
}

url=
title=
summary=
body=

while getopts ":u:" OPT; do
	case $OPT in
	u) url=$OPTARG;;
	*) die_getopts;;
	esac
done; shift $((OPTIND-1))

title=$1
summary=$2
body=$3

if ! [[ "$title" && "$summary" ]]; then
	die "missing title and/or summary"
fi

args=(-F "user=uSjWBy9oxBwZWgyJnXdPXM2eUbXnCN"
      -F "token=aW4NXZn1hk7NntWFQXEkddbA76Zx9n"
      -F "title=$HOSTNAME â€“ $title"
      -F "message=$summary")

if [[ "$body" ]]; then
	if [[ "$url" ]]; then
		die "URL and body cannot be specified together"
	elif [[ "$body" != "$summary" ]]; then
		url=($(curl -F "sprunge=$body" http://sprunge.us))
	fi
fi

if [[ "$url" ]]; then
	args+=(-F "url=$url")
fi

curl -s -o /dev/null "${args[@]}" https://api.pushover.net/1/messages.json
